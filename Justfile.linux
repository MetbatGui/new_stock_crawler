# Justfile for Linux (CI/CD)

default:
    @just -f Justfile.linux --list

# ì´ˆê¸° ì„¤ì •
init:
    @echo "ğŸš€ ì´ˆê¸° ì„¤ì •ì„ ì‹œì‘í•©ë‹ˆë‹¤..."
    @if [ ! -f .env ]; then cp .env.example .env; echo "â„¹ï¸  .env íŒŒì¼ ìƒì„±ë¨"; else echo "â„¹ï¸  .env íŒŒì¼ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤."; fi
    @if [ ! -d secrets ]; then mkdir secrets; echo "â„¹ï¸  secrets í´ë” ìƒì„±ë¨"; else echo "â„¹ï¸  secrets í´ë”ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤."; fi
    uv sync
    @echo "âœ… ì„¤ì • ì™„ë£Œ! secrets/client_secret.json íŒŒì¼ì„ ë„£ê³  'just auth'ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”."

build:
    docker compose build

# Docker execution
docker-full year="2020":
    docker compose run --rm crawler crawler full --start-year {{year}} --drive

docker-daily date="":
    docker compose run --rm crawler crawler daily {{ if date != "" { "--date " + date } else { "" } }} --drive

docker-enrich:
    docker compose run --rm crawler crawler enrich --drive

docker-auth:
    docker compose run --rm crawler crawler auth

docker-healthcheck:
    docker compose run --rm crawler crawler healthcheck

# Local execution (using uv) - Default
auth:
    uv run crawler auth

healthcheck:
    uv run crawler healthcheck

full year="2020":
    uv run crawler full --start-year {{year}} --drive

daily date="":
    uv run crawler daily {{ if date != "" { "--date " + date } else { "" } }} --drive

enrich:
    uv run crawler enrich --drive
