name: Daily IPO Crawler

on:
  schedule:
    # 매일 평일 한국 시간 16:00 (UTC 07:00) 실행
    - cron: '0 7 * * 1-5'
  workflow_dispatch:  # 수동 실행 가능

jobs:
  daily-crawl:
    runs-on: ubuntu-latest
    
    # Git Push를 위한 권한 설정
    permissions:
      contents: write
    
    # 타임존 설정 (로그 시간용)
    env:
      TZ: 'Asia/Seoul'
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Just
      uses: extractions/setup-just@v2

    - name: Create secrets directory
      run: mkdir -p secrets

    - name: Restore Client Secret
      run: echo "${{ secrets.GOOGLE_CLIENT_SECRET }}" > secrets/client_secret.json

    - name: Restore Token
      run: echo "${{ secrets.GOOGLE_TOKEN }}" > secrets/token.json

    - name: Create .env file
      run: |
        echo "GOOGLE_DRIVE_FOLDER_ID=${{ secrets.DRIVE_FOLDER_ID }}" > .env
        echo "LOG_LEVEL=INFO" >> .env

    - name: Run Daily Crawler (via Just & Docker)
      run: just daily

    # Google Drive 모드에서는 로컬 파일을 삭제하므로, 
    # 만약 로컬에도 남기고 싶다면 crawler 옵션을 조정하거나 로직을 변경해야 함.
    # 현재는 Google Drive 업로드가 주 목적이므로 Git Push 단계는 선택사항임.
